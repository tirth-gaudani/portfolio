---
import Header from '../components/Header.astro';
import MobileMenu from '../components/MobileMenu.astro';
import Footer from '../components/Footer.astro';
import { siteConfig } from '../data/siteConfig';
import '../styles/global.css';

interface Props {
  title: string;
  description: string;
  canonicalURL?: string;
  ogImage?: string;
  ogType?: 'website' | 'article';
  structuredData?: object;
}

const { 
  title, 
  description, 
  canonicalURL = Astro.url.href,
  ogImage = '/img/profile.png',
  ogType = 'website',
  structuredData
} = Astro.props;

const currentPath = Astro.url.pathname;
const fullTitle = title === siteConfig.title ? title : `${title} | ${siteConfig.name}`;
const fullOgImage = ogImage.startsWith('http') ? ogImage : `${siteConfig.url}${ogImage}`;

// Default structured data (Person schema for developer portfolio)
const defaultStructuredData = {
  "@context": "https://schema.org",
  "@type": "Person",
  "name": siteConfig.name,
  "url": siteConfig.url,
  "image": `${siteConfig.url}/img/profile.png`,
  "sameAs": [
    siteConfig.social.linkedin,
    siteConfig.social.github,
    siteConfig.social.twitter
  ],
  "jobTitle": "Senior MERN Stack Developer",
  "worksFor": {
    "@type": "Organization",
    "name": "Smartway Technoway Pvt. Ltd."
  },
  "alumniOf": [
    {
      "@type": "CollegeOrUniversity",
      "name": "Shree Swaminarayan Institute of Technology",
      "address": "Gandhinagar"
    },
    {
      "@type": "CollegeOrUniversity", 
      "name": "Bholabhai Patel College of Computer Studies",
      "address": "Gandhinagar"
    }
  ],
  "knowsAbout": ["React", "Node.js", "MongoDB", "Express.js", "JavaScript", "TypeScript", "Full Stack Development"],
  "address": {
    "@type": "PostalAddress",
    "addressLocality": "Ahmedabad",
    "addressRegion": "Gujarat",
    "addressCountry": "India"
  }
};

const jsonLd = structuredData || defaultStructuredData;
---

<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <!-- Essential Meta Tags -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  <!-- Primary Meta Tags for SEO -->
  <title>{fullTitle}</title>
  <meta name="title" content={fullTitle} />
  <meta name="description" content={description} />
  <meta name="keywords" content={siteConfig.keywords.join(', ')} />
  <meta name="author" content={siteConfig.author} />
  <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1" />
  <meta name="googlebot" content="index, follow" />
  <link rel="canonical" href={canonicalURL} />
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content={ogType} />
  <meta property="og:url" content={canonicalURL} />
  <meta property="og:title" content={fullTitle} />
  <meta property="og:description" content={description} />
  <meta property="og:image" content={fullOgImage} />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta property="og:locale" content={siteConfig.locale} />
  <meta property="og:site_name" content={siteConfig.name} />
  
  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:url" content={canonicalURL} />
  <meta name="twitter:title" content={fullTitle} />
  <meta name="twitter:description" content={description} />
  <meta name="twitter:image" content={fullOgImage} />
  <meta name="twitter:creator" content={siteConfig.twitter} />
  
  <!-- Theme and PWA -->
  <meta name="theme-color" content={siteConfig.themeColor} />
  <meta name="msapplication-TileColor" content={siteConfig.themeColor} />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content={siteConfig.name} />
  
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="/img/favicon.png" />
  <link rel="apple-touch-icon" href="/img/favicon.png" />
  <link rel="manifest" href="/manifest.json" />
  
  <!-- Preconnect for Performance -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  
  <!-- Fonts - Preload critical fonts -->
  <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Outfit:wght@300;400;500;600;700;800&display=swap" />
  <link 
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Outfit:wght@300;400;500;600;700;800&display=swap" 
    rel="stylesheet"
    media="print"
    onload="this.media='all'"
  />
  <noscript>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />
  </noscript>
  
  <!-- Font Awesome - Deferred loading -->
  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link 
    rel="stylesheet" 
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    media="print"
    onload="this.media='all'"
  />
  <noscript>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  </noscript>
  
  <!-- Structured Data (JSON-LD) -->
  <script type="application/ld+json" set:html={JSON.stringify(jsonLd)} />
  
  <!-- Generator Meta -->
  <meta name="generator" content={Astro.generator} />
</head>
<body>
  <Header currentPath={currentPath} />
  <MobileMenu currentPath={currentPath} />
  
  <slot />
  
  <Footer />
  
  <!-- Theme and Mobile Menu Script - Inlined for performance -->
  <script is:inline>
    // Theme Toggle
    (function() {
      const themeToggle = document.getElementById('themeToggle');
      const icon = document.getElementById('themeIcon');
      
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme === 'light') {
        document.documentElement.classList.remove('dark');
        if (icon) icon.className = 'fas fa-sun';
      }
      
      if (themeToggle && icon) {
        themeToggle.addEventListener('click', function() {
          const isDark = document.documentElement.classList.toggle('dark');
          localStorage.setItem('theme', isDark ? 'dark' : 'light');
          icon.className = isDark ? 'fas fa-moon' : 'fas fa-sun';
        });
      }
      
      // Mobile Menu
      const mobileBtn = document.getElementById('mobileBtn');
      const mobileMenu = document.getElementById('mobileMenu');
      const mobileClose = document.getElementById('mobileClose');
      
      if (mobileBtn && mobileMenu && mobileClose) {
        mobileBtn.addEventListener('click', function() {
          mobileMenu.classList.add('active');
          mobileBtn.setAttribute('aria-expanded', 'true');
          document.body.style.overflow = 'hidden';
        });
        
        mobileClose.addEventListener('click', function() {
          mobileMenu.classList.remove('active');
          mobileBtn.setAttribute('aria-expanded', 'false');
          document.body.style.overflow = '';
        });
        
        document.querySelectorAll('.mobile-link').forEach(function(link) {
          link.addEventListener('click', function() {
            mobileMenu.classList.remove('active');
            mobileBtn.setAttribute('aria-expanded', 'false');
            document.body.style.overflow = '';
          });
        });
      }
    })();
  </script>
</body>
</html>
